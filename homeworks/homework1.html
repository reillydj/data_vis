<!DOCTYPE html>

<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>MSAN 622 Homework 1</title>
	<link href="../css/bootstrap.min.css" rel="stylesheet">
	<link href="../css/bootstrap-theme.min.css" rel="stylesheet">
	<script type="text/javascript" src="../js/d3.v3.js"></script>
	<script type="text/javascript" src="../js/d3.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

	<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }

	.axis path,
	.axis line {
	    fill: none;
	    stroke: #000;
	    stroke-width: 3;
	    width: 20px;
	    shape-rendering: crispEdges;
	}

	.axis text {
	    font-family: sans-serif;
	    font-size: 11px;
	}

	.xaxis path,
	.xaxis line {
	    fill: none;
	    stroke: none;
	    width: 20px;
	    shape-rendering: crispEdges;
	}

	.xaxis text {
	    font-family: sans-serif;
	    font-size: 13px;
	}

	</style>
</head>

<body>

	<nav class="navbar navbar-inverse navbar-fixed-top">

	    <div class="container">

	        <div class="navbar-header">

	            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
	                <span class="sr-only">Toggle Navigation</span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	            </button>

	            <a class="navbar-brand" href="../index.html">MSN 622</a>

	        </div>

	    </div>

	</nav>

	<div class="jumbotron">

	    <div class="container">

	        <h1>My Information Visualization Collection</h1>
	        <p>Homework 1</p>

	    </div>

	</div>

	<div class="container">

		<p style="text-align: center;">
		    <svg id="demo" height="20" width="300"></svg>
		</p>

	</div>

	<script type="text/javascript">
		
		// var h = 500;
		// var w = 800;
		var barPadding = 10;
		var windw = window.innerWidth;
		var windh = window.innerHeight;
		var vowels = [ 'a', 'e', 'i', 'o', 'u', 'y' ];

		var margin = {top: 20, right: 30, bottom: 30, left: 40},
	    w = 760 - margin.left - margin.right,
	    h = 400 - margin.top - margin.bottom;

		// Add div box and part one header
		var levelC = d3.select("body")
						.append("div")
						.attr({
							"class": "levelC",
							"display": "block",
							"align-items": "center",
							"justify-content": "center"
						})
						.append("h1")
						.style({
							"text-align": "center",
						})
						.text("Homework 1: Letter Count Bar Chart")
						.style("color", "#2b8cbe");

		// Grab query string, remove non-alphanumeric characters
		function get_query_string() {
			var qstring = window.location.search;
			var stripped = qstring.replace(/[^A-z]/g, "");
			var lower = stripped.toLowerCase();
			return lower;
		};

		// Instantiate stripped query string
		var query_string = get_query_string();

		// Generate an counter object
		// Keys are individual letters in a string
		// Values are the number of occurences of each key
		function create_char_count_obj(string) {
			var counter = {};

			for (var i = 0; i < string.length; i++) {
				var sub_char = string.charAt(i)

				if(sub_char in counter) {
					counter[sub_char]++;
				} else {
					counter[sub_char] = 1;
				}
			}
			console.log(counter);
			return counter;
		}

		function draw_bar_chart(string) {
			// Instantiate counter object from query string
			var counter = create_char_count_obj(query_string);
			var values = Object.keys(counter).map(function(key){return counter[key]});
			var max_value = Math.max.apply(Math, values);

			var yScale = d3.scale.linear()
								 .domain([0, d3.max(d3.entries(counter), function(d) { return d.value; })])
								 .range([0, h]);

			var yAxisScale = d3.scale.linear()
							   .domain([0, d3.max(d3.entries(counter), function(d) { return d.value; })])
							   .range([h, 0]);

			var yAxis = d3.svg.axis()
							  .scale(yAxisScale)
							  .orient("left")
							  .ticks(d3.max(d3.entries(counter), function(d) { return d.value; }) + 1)
							  .tickFormat(d3.format(",.0f"));

			var xScale = d3.scale.ordinal()
							.domain(Object.keys(counter).sort())
							.rangeBands([0, w], 0.1);

			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom");

			var query_count_bar = d3.select("div.levelC")
									.append("svg")
									.attr({
										'height': h + margin.top + margin.bottom,
										'width': w + margin.left + margin.right,
										'display': 'block',
										'margin': "auto"
									})
									.style("display", "block")
									.style("margin", "auto");

			var tooltip = d3.select("body")
						    .append("div")
						    .style("position", "absolute")
						    .style("z-index", "10")
						    .style("visibility", "hidden")
						    .text("a simple tooltip");

			query_count_bar.selectAll("rect")
				.data(d3.entries(counter).sort(function(d) {return d.key}))
				.enter()
				.append("rect")
				.attr("x", function(d, i) {
					return (i * (w / (d3.entries(counter).length))) + margin.left + margin.right + barPadding;
				})
				.attr("y", function(d, i) {
					return h - yScale(d.value) + margin.top;
				})
				.attr("width", w / d3.entries(counter).length - barPadding)
				.attr("height", function(d, i) {
					return (yScale(d.value));
				})
				.attr("fill", function(d, i) {
					if (vowels.indexOf(d.key) > -1) {
						return "#2b8cbe";
					} else {
						return "#b2df8a";
					}})
				.on("mouseover", function(d) {
					tooltip.text("Count = " + d.value); 
					return tooltip.style("visibility", "visible");
				})
				.on("mousemove", function() {
					return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
				})
				.on("mouseout", function() {
					return tooltip.style("visibility", "hidden");
				});

			var xAxisXMargin = margin.left + barPadding;
			var xAxisYMargin = margin.top;

			query_count_bar.append("g")
							.attr("class", "axis")
							.attr("transform", "rotate(90)")
							.attr("transform", "translate(" + xAxisXMargin + "," + xAxisYMargin + ")")
							.call(yAxis)
							.append("text")
						    .attr("transform", "rotate(-90)")
						    .attr("y", 6)
						    .attr("dy", ".71em")
						    .style("text-anchor", "end")
						    .text("Count");

			var yAxisXMargin = margin.left + margin.right + 0.5 * barPadding;
			var yAxisYMargin = h + margin.bottom - barPadding;

			query_count_bar.append("g")
				           .attr("class", "xaxis")
				           .attr("transform", "translate(" + yAxisXMargin + "," + yAxisYMargin + ")")
				           .call(xAxis);
		}

		if (query_string != '') {
			d3.select("div.levelC")
			.append("p")
			.text("Query String = " + query_string)
			.style({
				"color": "#2b8cbe",
				"text-align": "center"
			});
			console.log(query_string);
			draw_bar_chart(query_string);
		} else {
			d3.select("div.levelC")
			  .append("p")
			  .text("Please add a query string to the end of the URL and refresh the page, e.g. url.html?myQueryString")
			  .style({
			  	"color": "#2b8cbe",
			  	"text-align": "center"
			  })
		}
	</script>

	<hr/>

	<footer>
	    <p style="text-align: center;">David Reilly &bullet; MSAN 622 Information Visualization &bullet; Spring 2015</p>
	</footer>

	<script src="../js/jquery.min.js"></script>
	<script src="../js/bootstrap.min.js"></script>
	<script src="../js/d3.min.js"></script>
	<script src="../js/d3.v3.js"></script>
</body>

</html>
